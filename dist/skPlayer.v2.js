!function(e){var s=function(){var e=['<audio src="{{src}}" preload="auto"></audio>','<div class="skPlayer-picture">','   <img src="{{cover}}" alt="" class="skPlayer-cover">','   <a href="javascript:;" class="skPlayer-play-btn">','       <span class="skPlayer-left"></span>','       <span class="skPlayer-right"></span>',"   </a>","</div>",'<div class="skPlayer-control">','   <p class="skPlayer-name">{{name}}</p>','   <p class="skPlayer-author">{{author}}</p>','   <div class="skPlayer-percent">','       <div class="skPlayer-line"></div>',"   </div>",'   <p class="skPlayer-time">','       <span class="skPlayer-cur">00:00</span>/<span class="skPlayer-total">00:00</span>',"   </p>",'   <div class="skPlayer-volume skPlayer-hasList">','       <i class="skPlayer-icon" data-volume="0"></i>','       <div class="skPlayer-percent">','           <div class="skPlayer-line"></div>',"       </div>","   </div>",'   <div class="skPlayer-list-switch">','       <i class="skPlayer-list-icon"></i>',"   </div>","</div>"].join(""),s=['<li data-index="{{item}}" >','       <i class="skPlayer-list-sign"></i>','       <span class="skPlayer-list-index">{{number}}</span>','       <span class="skPlayer-list-name">{{name}}</span>','       <span class="skPlayer-list-author" title="{{author}}">{{author}}</span>',"   </li>"].join(""),t=function(e){this.id=e.id,this.autoLoop=e.autoLoop,this.musicList=e.musicList,this.songNumber=e.songNumber,this.fetch()};return t.prototype={addEvents:function(){function e(){o.loop===!0&&(y.loop=!0),duration=this.duration,h.innerHTML="00:00",L.innerHTML=o.dateFormat(parseInt(duration)),1==y.volume&&(y.volume=.7,p.style.width="70%"),k.addEventListener("click",a)}function s(){duration=this.duration}function t(){var e=parseInt(y.currentTime),s=e/duration*100;v.style.width=s.toFixed(2)+"%",h.innerHTML=o.dateFormat(e)}function r(){if(o.musicAllList.length>0){var e=parseInt(d.querySelector(".skPlayer-curMusic").getAttribute("data-index"))+1;if(e<music.length){1!==d.querySelector(".skPlayer-curMusic").nextSibling?d.querySelector(".skPlayer-curMusic").nextSibling.nextSibling.classList.add("skPlayer-curMusic"):d.querySelector(".skPlayer-curMusic").nextSibling.classList.add("skPlayer-curMusic"),d.querySelector(".skPlayer-curMusic").classList.remove("skPlayer-curMusic");var s=music[e]}else{d.querySelector(".skPlayer-list li").classList.add("skPlayer-curMusic"),d.querySelectorAll(".skPlayer-curMusic")[1].classList.remove("skPlayer-curMusic");var s=music[0]}d.querySelector(".skPlayer-name").innerHTML=s.name,d.querySelector(".skPlayer-author").innerHTML=s.author,d.querySelector(".skPlayer-cover").src=s.cover,y.src=s.src,k.classList.contains("skPlayer-pause")&&y.play()}else k.classList.remove("skPlayer-pause"),S.classList.remove("skPlayer-pause");h.innerHTML="00:00",v.style.width=0}function a(){y.paused?y.play():y.pause(),k.classList.contains("skPlayer-pause")?(k.classList.remove("skPlayer-pause"),S.classList.remove("skPlayer-pause")):(k.classList.add("skPlayer-pause"),S.classList.add("skPlayer-pause"))}function i(e){var s,t=window.event||e;s=t.pageX?(t.pageX-o.leftDistance(this))/this.offsetWidth:(t.clientX-o.leftDistance(this))/this.offsetWidth,v.style.width=100*s+"%",y.currentTime=parseInt(s*duration)}function l(e){var s=window.event||e;f.classList.contains("skPlayer-quiet")&&f.classList.remove("skPlayer-quiet");var t;t=s.pageX?(s.pageX-o.leftDistance(this))/this.offsetWidth:(s.clientX-o.leftDistance(this))/this.offsetWidth,p.style.width=100*t+"%",y.volume=t.toFixed(2)}function n(){0!=y.volume?(f.setAttribute("data-volume",y.volume),y.volume=0,p.style.width=0,f.classList.add("skPlayer-quiet")):(y.volume=f.getAttribute("data-volume"),p.style.width=100*f.getAttribute("data-volume")+"%",f.setAttribute("data-volume","0"),f.classList.remove("skPlayer-quiet"))}function c(){if(!this.classList.contains("skPlayer-curMusic")){d.querySelector(".skPlayer-curMusic").classList.remove("skPlayer-curMusic"),this.classList.add("skPlayer-curMusic");var e=this.getAttribute("data-index"),s=o.musicAllList[e];d.querySelector(".skPlayer-name").innerHTML=s.name,d.querySelector(".skPlayer-author").innerHTML=s.author,d.querySelector(".skPlayer-cover").src=s.cover,y.src=s.src,k.classList.contains("skPlayer-pause")&&y.play(),h.innerHTML="00:00",v.style.width=0}}function u(){d.classList.contains("skPlayer-list-on")?d.classList.remove("skPlayer-list-on"):d.classList.add("skPlayer-list-on")}var o=this,d=document.querySelector(o.id),y=d.querySelector("audio"),k=d.querySelector(".skPlayer-play-btn"),v=d.querySelector(".skPlayer-percent .skPlayer-line"),P=d.querySelector(".skPlayer-percent"),p=d.querySelector(".skPlayer-volume .skPlayer-line"),m=d.querySelector(".skPlayer-volume .skPlayer-percent"),f=d.querySelector(".skPlayer-icon"),h=d.querySelector(".skPlayer-cur"),L=d.querySelector(".skPlayer-total"),S=d.querySelector(".skPlayer-cover"),q=d.querySelectorAll(".skPlayer-list li"),M=d.querySelector(".skPlayer-list-switch");if(d.classList.add("skPlayer-list-on"),y.addEventListener("canplay",e),y.addEventListener("durationchange",s),y.addEventListener("timeupdate",t),y.addEventListener("ended",r),P.addEventListener("click",i),m.addEventListener("click",l),f.addEventListener("click",n),this.musicAllList.length>0){for(var g in this.musicAllList)q[g].addEventListener("click",c);d.querySelector(".skPlayer-list li:nth-child(1)").classList.add("skPlayer-curMusic"),M.addEventListener("click",u)}},fetch:function(){var e=this;return this.songNumber?void e.ajax({url:"http://120.24.162.247/api/Music?id="+e.songNumber,type:"GET",data:null,success:function(s){var t=JSON.parse(s);e.render(t)},error:function(){e.render(result),console.error("请求歌曲列表失败")}}):void e.render([])},render:function(t){var r=this;this.musicAllList=t=t.concat(r.musicList);var a=document.querySelector(r.id),i=r.htmlTpl(e,t[0]);a.innerHTML=i;var l=t.map(function(e,a){return r.htmlTpl(s,r.extend(t[a],{item:a,number:a+1}))}).join(""),n=document.createElement("ul");n.className="skPlayer-list",n.innerHTML=l,a.appendChild(n),r.addEvents()},extend:function(e,s){for(var t in s)e[t]=s[t];return e},leftDistance:function(e){for(var s=e.offsetLeft;e.offsetParent;)e=e.offsetParent,s+=e.offsetLeft;return s},dateFormat:function(e){var s=parseInt(e/60),t=parseInt(e%60),r=s<10?"0"+s:s,a=t<10?"0"+t:t;return r+":"+a},htmlTpl:function(e,s){return e.replace(/{{(\w+)}}/g,function(){return s[arguments[1]]})},ajax:function(e){var e=e||{},s=new XMLHttpRequest;s.open(e.type,e.url,!0),s.send(e.data),s.onreadystatechange=function(){if(4==s.readyState){var t=s.status;t>=200&&t<300?e.success&&e.success(s.responseText,s.responseXML):e.error&&e.error(t)}}}},t}();e.skPlayer=s}(window),"undefined"!=typeof module&&"undefined"!=typeof module.exports&&(module.exports=window.skPlayer);