!function(e){var s=function(){var s=['<audio src="{{src}}" preload="auto"></audio>','<div class="skPlayer-picture">','   <img src="{{cover}}" alt="" class="skPlayer-cover">','   <a href="javascript:;" class="skPlayer-play-btn">','       <span class="skPlayer-left"></span>','       <span class="skPlayer-right"></span>',"   </a>","</div>",'<div class="skPlayer-control">','   <p class="skPlayer-name">{{name}}</p>','   <p class="skPlayer-author">{{author}}</p>','   <div class="skPlayer-percent">','       <div class="skPlayer-line"></div>',"   </div>",'   <p class="skPlayer-time">','       <span class="skPlayer-cur">00:00</span>/<span class="skPlayer-total">00:00</span>',"   </p>",'   <div class="skPlayer-volume skPlayer-hasList">','       <i class="skPlayer-icon" data-volume="0"></i>','       <div class="skPlayer-percent">','           <div class="skPlayer-line"></div>',"       </div>","   </div>",'   <div class="skPlayer-list-switch">','       <i class="skPlayer-list-icon"></i>',"   </div>","</div>"].join(""),t=['<li data-index="{{item}}" >','       <i class="skPlayer-list-sign"></i>','       <span class="skPlayer-list-index">{{number}}</span>','       <span class="skPlayer-list-name">{{name}}</span>','       <span class="skPlayer-list-author" title="{{author}}">{{author}}</span>',"   </li>"].join(""),r=function(e){this.id=e.id,this.autoLoop=e.autoLoop,this.musicList=e.musicList,this.songNumber=e.songNumber,this.fetch()};return r.prototype={addEvents:function(){function s(){d.loop===!0&&(k.loop=!0),duration=this.duration,L.innerHTML="00:00",S.innerHTML=d.dateFormat(parseInt(duration)),1==k.volume&&(k.volume=.7,m.style.width="70%"),v.addEventListener("click",i)}function t(){duration=this.duration}function r(){var e=parseInt(k.currentTime),s=e/duration*100;P.style.width=s.toFixed(2)+"%",L.innerHTML=d.dateFormat(e)}function a(){if(d.musicAllList.length>0){var e=parseInt(y.querySelector(".skPlayer-curMusic").getAttribute("data-index"))+1;if(e<music.length){1!==y.querySelector(".skPlayer-curMusic").nextSibling?y.querySelector(".skPlayer-curMusic").nextSibling.nextSibling.classList.add("skPlayer-curMusic"):y.querySelector(".skPlayer-curMusic").nextSibling.classList.add("skPlayer-curMusic"),y.querySelector(".skPlayer-curMusic").classList.remove("skPlayer-curMusic");var s=music[e]}else{y.querySelector(".skPlayer-list li").classList.add("skPlayer-curMusic"),y.querySelectorAll(".skPlayer-curMusic")[1].classList.remove("skPlayer-curMusic");var s=music[0]}y.querySelector(".skPlayer-name").innerHTML=s.name,y.querySelector(".skPlayer-author").innerHTML=s.author,y.querySelector(".skPlayer-cover").src=s.cover,k.src=s.src,v.classList.contains("skPlayer-pause")&&k.play()}else v.classList.remove("skPlayer-pause"),q.classList.remove("skPlayer-pause");L.innerHTML="00:00",P.style.width=0}function i(){k.paused?k.play():k.pause(),v.classList.contains("skPlayer-pause")?(v.classList.remove("skPlayer-pause"),q.classList.remove("skPlayer-pause")):(v.classList.add("skPlayer-pause"),q.classList.add("skPlayer-pause"))}function l(s){var t,r=e.event||s;t=r.pageX?(r.pageX-d.leftDistance(this))/this.offsetWidth:(r.clientX-d.leftDistance(this))/this.offsetWidth,P.style.width=100*t+"%",k.currentTime=parseInt(t*duration)}function n(s){var t=e.event||s;h.classList.contains("skPlayer-quiet")&&h.classList.remove("skPlayer-quiet");var r;r=t.pageX?(t.pageX-d.leftDistance(this))/this.offsetWidth:(t.clientX-d.leftDistance(this))/this.offsetWidth,m.style.width=100*r+"%",k.volume=r.toFixed(2)}function c(){0!=k.volume?(h.setAttribute("data-volume",k.volume),k.volume=0,m.style.width=0,h.classList.add("skPlayer-quiet")):(k.volume=h.getAttribute("data-volume"),m.style.width=100*h.getAttribute("data-volume")+"%",h.setAttribute("data-volume","0"),h.classList.remove("skPlayer-quiet"))}function u(){if(!this.classList.contains("skPlayer-curMusic")){y.querySelector(".skPlayer-curMusic").classList.remove("skPlayer-curMusic"),this.classList.add("skPlayer-curMusic");var e=this.getAttribute("data-index"),s=d.musicAllList[e];y.querySelector(".skPlayer-name").innerHTML=s.name,y.querySelector(".skPlayer-author").innerHTML=s.author,y.querySelector(".skPlayer-cover").src=s.cover,k.src=s.src,v.classList.contains("skPlayer-pause")&&k.play(),L.innerHTML="00:00",P.style.width=0}}function o(){y.classList.contains("skPlayer-list-on")?y.classList.remove("skPlayer-list-on"):y.classList.add("skPlayer-list-on")}var d=this,y=document.querySelector(d.id),k=y.querySelector("audio"),v=y.querySelector(".skPlayer-play-btn"),P=y.querySelector(".skPlayer-percent .skPlayer-line"),p=y.querySelector(".skPlayer-percent"),m=y.querySelector(".skPlayer-volume .skPlayer-line"),f=y.querySelector(".skPlayer-volume .skPlayer-percent"),h=y.querySelector(".skPlayer-icon"),L=y.querySelector(".skPlayer-cur"),S=y.querySelector(".skPlayer-total"),q=y.querySelector(".skPlayer-cover"),M=y.querySelectorAll(".skPlayer-list li"),g=y.querySelector(".skPlayer-list-switch");if(y.classList.add("skPlayer-list-on"),k.addEventListener("canplay",s),k.addEventListener("durationchange",t),k.addEventListener("timeupdate",r),k.addEventListener("ended",a),p.addEventListener("click",l),f.addEventListener("click",n),h.addEventListener("click",c),this.musicAllList.length>0){for(var b in this.musicAllList)M[b].addEventListener("click",u);y.querySelector(".skPlayer-list li:nth-child(1)").classList.add("skPlayer-curMusic"),g.addEventListener("click",o)}},fetch:function(){var e=this;return this.songNumber?void e.ajax({url:"http://120.24.162.247/api/Music?id="+e.songNumber,type:"GET",data:null,success:function(s){var t=JSON.parse(s);e.render(t)},error:function(){e.render(result),console.error("请求歌曲列表失败")}}):void e.render([])},render:function(e){var r=this;this.musicAllList=e=e.concat(r.musicList);var a=document.querySelector(r.id),i=r.htmlTpl(s,e[0]);a.innerHTML=i;var l=e.map(function(s,a){return r.htmlTpl(t,r.extend(e[a],{item:a,number:a+1}))}).join(""),n=document.createElement("ul");n.className="skPlayer-list",n.innerHTML=l,a.appendChild(n),r.addEvents()},extend:function(e,s){for(var t in s)e[t]=s[t];return e},leftDistance:function(e){for(var s=e.offsetLeft;e.offsetParent;)e=e.offsetParent,s+=e.offsetLeft;return s},dateFormat:function(e){var s=parseInt(e/60),t=parseInt(e%60),r=s<10?"0"+s:s,a=t<10?"0"+t:t;return r+":"+a},htmlTpl:function(e,s){return e.replace(/{{(\w+)}}/g,function(){return s[arguments[1]]})},ajax:function(e){var e=e||{},s=new XMLHttpRequest;s.open(e.type,e.url,!0),s.send(e.data),s.onreadystatechange=function(){if(4==s.readyState){var t=s.status;t>=200&&t<300?e.success&&e.success(s.responseText,s.responseXML):e.error&&e.error(t)}}}},r}();e.skPlayer=s}(window),"undefined"!=typeof module&&"undefined"!=typeof module.exports&&(module.exports=window.skPlayer);